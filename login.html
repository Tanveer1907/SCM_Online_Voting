<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Login / Sign Up - Voting Zone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="styles_login.css" />
  <script>
    // Always allow access to login page; protect main page instead
  </script>
</head>
<body class="login-bg">
  <div class="login-card">
    <div class="login-brand">
      <img src="https://img.icons8.com/ios-filled/50/4a90e2/ballot.png" alt="Voting Icon" />
      <h1>Online Voting Zone</h1>
    </div>
    <div class="tab-buttons">
      <button id="loginTab" class="active" onclick="showTab('login')">Log In</button>
      <button id="signupTab" onclick="showTab('signup')">Sign Up</button>
    </div>
    <div id="loginFormDiv">
      <form id="loginForm" onsubmit="return handleLogin(event)">
        <div class="input-group">
          <span class="input-icon">@</span>
          <input type="email" placeholder="Email Address" id="loginEmail" required autocomplete="email">
        </div>
        <div id="loginError" class="form-error"></div>
        <button type="submit" class="main-btn">Log In</button>
      </form>
    </div>
    <div id="signupFormDiv" style="display:none;">
      <form id="signupForm" onsubmit="return handleSignup(event)">
        <div class="input-group">
          <span class="input-icon">&#128100;</span>
          <input type="text" placeholder="Full Name" id="signupName" required>
        </div>
        <div class="input-group">
          <span class="input-icon">@</span>
          <input type="email" placeholder="Email Address" id="signupEmail" required autocomplete="email">
        </div>
        <div class="input-group">
          <span class="input-icon">&#128274;</span>
          <input type="password" placeholder="Password" id="signupPassword" required autocomplete="new-password">
        </div>
        <div id="signupError" class="form-error"></div>
        <button type="submit" class="main-btn">Sign Up</button>
      </form>
      <div class="divider"><span>or</span></div>
      <div class="g_id_signin" data-type="standard"></div>
    </div>
  </div>
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script>
    // Tab switching
    function showTab(tab) {
      document.getElementById('loginFormDiv').style.display = (tab === 'login') ? 'block' : 'none';
      document.getElementById('signupFormDiv').style.display = (tab === 'signup') ? 'block' : 'none';
      document.getElementById('loginTab').classList.toggle('active', tab === 'login');
      document.getElementById('signupTab').classList.toggle('active', tab === 'signup');
      // Clear errors on tab switch
      document.getElementById('loginError').textContent = '';
      document.getElementById('signupError').textContent = '';
    }
    // Dummy localStorage "users" for demo
    let users = JSON.parse(localStorage.getItem('users')) || {};

    function handleSignup(event) {
      event.preventDefault();
      const name = document.getElementById('signupName').value.trim();
      const email = document.getElementById('signupEmail').value.trim();
      const password = document.getElementById('signupPassword').value;
      const signupError = document.getElementById('signupError');
      if (users[email]) {
        signupError.textContent = "User already exists. Please log in.";
        showTab('login');
        return false;
      }
      users[email] = { name, email, password };
      localStorage.setItem('users', JSON.stringify(users));
      localStorage.setItem('user', JSON.stringify({ name, email }));
      window.location.href = "div.html";
      return false;
    }

    function handleLogin(event) {
      event.preventDefault();
      const email = document.getElementById('loginEmail').value.trim();
      const loginError = document.getElementById('loginError');
      if (!users[email]) {
        loginError.textContent = "No account found with this email. Please sign up first.";
        return false;
      }
      // If found, log in without password (as per your requirement)
      localStorage.setItem('user', JSON.stringify({ name: users[email].name, email }));
      window.location.href = "div.html";
      return false;
    }

    // Google Sign-In (works for both new and existing users)
    window.onload = function() {
      google.accounts.id.initialize({
        client_id: "62132248350-0glmrvicu47pltakq9mgt643f5ee7rvv.apps.googleusercontent.com",
        callback: function(response) {
          const data = parseJwt(response.credential);
          // Save as both user and in users list for demo
          users[data.email] = { name: data.name, email: data.email, password: "" };
          localStorage.setItem('users', JSON.stringify(users));
          localStorage.setItem('user', JSON.stringify({ name: data.name, email: data.email }));
          window.location.href = "div.html";
        }
      });
      google.accounts.id.renderButton(
        document.querySelector(".g_id_signin"),
        { theme: "outline", size: "large" }
      );
    };
    function parseJwt (token) {
      var base64Url = token.split('.')[1];
      var base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
      var jsonPayload = decodeURIComponent(atob(base64).split('').map(function(c) {
          return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
      }).join(''));
      return JSON.parse(jsonPayload);
    }
  </script>
</body>
</html>
