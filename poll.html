<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Poll - Online Voting Zone</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="stylesheet" href="index.css" />
  <style>
    body {
      background: linear-gradient(120deg, #eaf4ff 0%, #f7fafd 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .poll-wrapper {
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(0, 51, 102, 0.10), 0 1.5px 4px rgba(0,0,0,0.04);
      padding: 2.5rem 2rem 2rem 2rem;
      width: 400px;
      max-width: 98vw;
      text-align: center;
      position: relative;
      animation: fadeIn 0.8s;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .poll-wrapper h2 {
      color: #0d47a1;
      font-size: 2rem;
      margin-bottom: 1.2rem;
      font-weight: 700;
      letter-spacing: 1px;
    }
    .poll-area label {
      display: block;
      margin-bottom: 16px;
      border-radius: 8px;
      padding: 12px 18px;
      border: 2px solid #e6e6e6;
      background: #f7fafd;
      transition: border-color 0.2s, background 0.2s;
      cursor: pointer;
      font-size: 1.08rem;
      text-align: left;
      position: relative;
    }
    .poll-area label.selected,
    .poll-area label:hover {
      border-color: #007bff;
      background: #e3f2fd;
    }
    .poll-area input[type="radio"] {
      accent-color: #007bff;
      margin-right: 12px;
      transform: scale(1.2);
      vertical-align: middle;
    }
    .poll-btn {
      background-color: #007bff;
      color: white;
      border: none;
      padding: 0.8rem 1.5rem;
      border-radius: 6px;
      font-size: 1.1rem;
      cursor: pointer;
      margin-top: 1.2rem;
      transition: background 0.3s;
      font-weight: 600;
    }
    .poll-btn:hover {
      background-color: #0056b3;
    }
    .poll-result {
      margin-top: 2rem;
      text-align: center;
    }
    .poll-result h3 {
      color: #0d47a1;
      margin-bottom: 1.2rem;
    }
    #pollChart {
      margin: 0 auto;
      max-width: 360px;
      background: #f7fafd;
      border-radius: 10px;
      padding: 1rem 0.5rem;
    }
    @media (max-width: 500px) {
      .poll-wrapper {
        padding: 1.5rem 0.5rem;
        width: 98vw;
      }
    }
    
  </style>
</head>
<body>
  <div class="poll-card">
    <h2 id="pollTitle">Which programming language do you like most?</h2>
    <p id="pollDesc" class="poll-desc">Vote for your favorite language below!</p>
    <form id="pollForm">
      <fieldset>
        <legend class="visually-hidden">Poll options</legend>
        <label for="opt1"><input type="radio" id="opt1" name="option" value="Python"> Python üêç</label>
        <label for="opt2"><input type="radio" id="opt2" name="option" value="JavaScript"> JavaScript ‚ú®</label>
        <label for="opt3"><input type="radio" id="opt3" name="option" value="Java"> Java ‚òï</label>
        <label for="opt4"><input type="radio" id="opt4" name="option" value="C++"> C++ üöÄ</label>
      </fieldset>
      <button type="submit" class="poll-btn" disabled>Vote</button>
      <div id="pollError" class="form-error"></div>
    </form>
    <div id="pollResult" style="display:none;">
      <div class="thank-you">Thank you for voting!</div>
      <canvas id="pollChart" width="360" height="260"></canvas>
      <button onclick="window.location.href='div.html'" class="main-btn" style="margin-top:1rem;">Back to Polls</button>
    </div>
  </div>
  

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    const pollForm = document.getElementById('pollForm');
pollForm.addEventListener('change', function() {
  pollForm.querySelector('.poll-btn').disabled = !pollForm.querySelector('input[name="option"]:checked');
});

    // --- Configurable Poll Data ---
    const pollData = {
      "1": {
        title: "Which programming language do you like most?",
        options: ["Python üêç", "JavaScript ‚ú®", "Java ‚òï", "C++ üöÄ"]
      },
      "2": {
        title: "What's your favorite fruit?",
        options: ["Apple üçé", "Banana üçå", "Orange üçä", "Grapes üçá"]
      }
      // Add more polls as needed
    };

    // --- Get poll ID from URL ---
    const params = new URLSearchParams(window.location.search);
    const pollId = params.get('poll') || "1";
    const poll = pollData[pollId];

    const pollTitle = document.getElementById('pollTitle');
    const pollForm = document.getElementById('pollForm');
    const pollResult = document.getElementById('pollResult');
    const POLL_KEY = "pollVotes_" + pollId;
    const POLL_VOTED_KEY = POLL_KEY + "_voted";
    let chart = null;

    // --- Render poll form dynamically ---
    function renderPollForm() {
      pollTitle.textContent = poll.title;
      pollForm.innerHTML = poll.options.map((opt, idx) =>
        `<label>
          <input type="radio" name="option" value="${opt}" required>
          ${opt}
        </label>`
      ).join('') +
      `<button type="submit" class="poll-btn">Vote</button>`;
      pollForm.style.display = "block";
      pollResult.style.display = "none";
    }

    // --- Load votes or initialize ---
    let votes = JSON.parse(localStorage.getItem(POLL_KEY)) ||
      Object.fromEntries(poll.options.map(opt => [opt, 0]));

    // --- Show voting form if not voted, else show results ---
    if (localStorage.getItem(POLL_VOTED_KEY)) {
      showResults();
    } else {
      renderPollForm();
    }

    // --- Highlight selected label ---
    pollForm.addEventListener('change', e => {
      if (e.target.name === "option") {
        pollForm.querySelectorAll('label').forEach(label => label.classList.remove('selected'));
        e.target.closest('label').classList.add('selected');
      }
    });

    // --- Handle vote submission ---
    pollForm.onsubmit = function(e) {
      e.preventDefault();
      const selected = pollForm.option.value;
      // Prevent double voting
      if (localStorage.getItem(POLL_VOTED_KEY)) {
        alert("You have already voted!");
        return;
      }
      votes[selected]++;
      localStorage.setItem(POLL_KEY, JSON.stringify(votes));
      localStorage.setItem(POLL_VOTED_KEY, "true");
      showResults();
    };

    // --- Show results with Chart.js ---
    function showResults() {
      pollForm.style.display = "none";
      pollResult.style.display = "block";
      // Prepare data for Chart.js
      const labels = Object.keys(votes);
      const data = Object.values(votes);

      // Destroy previous chart if exists
      if (chart) chart.destroy();

      const ctx = document.getElementById('pollChart').getContext('2d');
      chart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Votes',
            data: data,
            backgroundColor: [
              '#007bff',
              '#28a745',
              '#ffc107',
              '#ff6384'
            ],
            borderWidth: 1
          }]
        },
        options: {
          responsive: true,
          scales: {
            y: { beginAtZero: true, ticks: { stepSize: 1 } }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });

      // Live update every 3 seconds
      setInterval(() => {
        const newVotes = JSON.parse(localStorage.getItem(POLL_KEY)) || votes;
        if (JSON.stringify(newVotes) !== JSON.stringify(votes)) {
          votes = newVotes;
          chart.data.datasets[0].data = Object.values(votes);
          chart.update();
        }
      }, 3000);
    }
  </script>
</body>
</html>
